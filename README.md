<!-- Author: Aman Rathore
Contact: amanr.me | amanrathore9753 <at> gmail <dot> com
Created on: Monday, July 14, 2025 at 10:40 -->

<div align="center">
  <h1>üê≠ ToxTrac Data Analyzer</h1>
  <p><strong>A comprehensive command-line tool for analyzing animal tracking data from ToxTrac</strong></p>
  
  [![Python](https://img.shields.io/badge/Python-3.13+-blue.svg)](https://python.org)
  [![Version](https://img.shields.io/badge/Version-1.0.0-orange.svg)](src/__init__.py)
  [![Contributions Welcome](https://img.shields.io/badge/contributions-welcome-brightgreen.svg?style=flat)](issues.md)
</div>

---

<p align="center">
    <strong>ToxTrac Data Analyzer</strong> is a powerful, feature-rich command-line application designed to process and analyze animal tracking data generated by <a href="https://sourceforge.net/projects/toxtrac/">ToxTrac</a>. It provides comprehensive zone-based analysis, movement statistics, behavioral metrics, and advanced visualization capabilities for neuroscience and behavioral research.
</p>

> Note: This documentation along with entire codebase is generated using vibe coding mainly using Claud Sonnet 4 via [GitHub Copilot](https://github.com/features/copilot). This project was not created while keeping maintainability in mind, but just for a single thing(at-least at it's dawn) that is "get time spent & distance traveled in different zones of [OFT](https://github.com/AmanRathoreP/ToxTrac-Data-Analyser/tree/master/samples/Sample-1-Open-Field-side-by-side)".

---

## üìã Table of Contents

<details>
<summary><strong>Click to expand</strong></summary>

- [üéØ Key Features](#-key-features)
- [üîß System Requirements](#-system-requirements)
- [üöÄ Quick Start Guide](#-quick-start-guide)
  - [Installation](#installation)
  - [Basic Usage](#basic-usage)
- [üìä Zone Types & Analysis](#-zone-types--analysis)
  - [EPM (Elevated Plus Maze)](#epm-elevated-plus-maze)
  - [Open Field Test](#open-field-test)
  - [OFT (Open Field Test) Zones](#oft-open-field-test-zones)
  - [Custom Zones](#custom-zones)
- [üíª Command Reference](#-command-reference)
  - [Main Commands](#main-commands)
  - [Analysis Options](#analysis-options)
  - [Output Formats](#output-formats)
- [üìà Visualization & Plotting](#-visualization--plotting)
- [üìÅ Input/Output Structure](#-inputoutput-structure)
- [üî¨ Analysis Results](#-analysis-results)
- [üõ†Ô∏è Advanced Usage](#Ô∏è-advanced-usage)
- [üìö Examples](#-examples)
- [ü§ù Contributing](#-contributing)
- [üë®‚Äçüíª About Author](#-about-author)
- [üìú License](#-license)

</details>

---

## üéØ Key Features  <a id="-key-features"></a>

### üîç **Data Processing**
- **Direct ToxTrac Integration**: Seamlessly imports tracking data from ToxTrac `Tracking_RealSpace.txt` files
- **Robust File Detection**: Automatically discovers tracking files in directory structures
- **Missing Data Handling**: Intelligent gap detection and linear interpolation for missing animal positions
- **Multiple Session Support**: Batch processing of multiple experimental sessions
- **Data Validation**: Comprehensive file size and data point validation with safety limits

### üó∫Ô∏è **Zone-Based Analysis**
- **Multiple Zone Types**: Support for EPM, Open Field, OFT, and custom zone configurations
- **Flexible Zone Creation**: Interactive GUI-based zone definition or JSON configuration
- **Individual vs. Collective**: Separate zones for each session or unified zones across sessions
- **Configurable Parameters**: Adjustable zone ratios and dimensions

### üìä **Comprehensive Analytics**
- **Time Analysis**: Time spent inside/outside zones with percentage calculations
- **Movement Metrics**: Distance traveled, speed analysis, and trajectory statistics
- **Visit Patterns**: Entry/exit counts, visit duration statistics (mean, longest, shortest)
- **Gap-Aware Calculations**: Proper handling of missing data frames in distance calculations
- **Statistical Summaries**: Mean, standard deviation, and comparative analysis across sessions

### üé® **Advanced Visualization**
- **6 Plot Types per Session**:
  - Trajectory plots with zone overlays (zone-colored and speed-colored)
  - Zone occupancy bar charts
  - Speed distribution histograms
  - Movement heatmaps
  - Time series analysis
- **2 Summary Plot Types**:
  - Session comparison plots
  - Zone usage summary plots
- **High-Quality Output**: 300 DPI publication-ready plots
- **Interactive Zone Creation**: GUI-based zone definition with real-time visualization

### üíæ **Flexible Output Options**
- **Multiple Formats**: CSV, JSON, and console output
- **Timestamped Results**: Organized output in timestamped directories
- **Detailed Logging**: Comprehensive logging with Rich formatting
- **Session Reports**: Individual and summary reports with statistical analysis

---

## üîß System Requirements <a id="-system-requirements"></a>

### **Required Dependencies**
- **Python**: 3.13+ (recommended)
- **Core Libraries**: pandas, numpy, matplotlib, typer, rich
- **GUI Libraries**: tkinter (for interactive zone creation)
- **Statistical Libraries**: scipy, scikit-bio

### **Supported Platforms**
- ‚úÖ Windows 10/11
- ‚úÖ macOS 10.15+
- ‚úÖ Linux (Ubuntu 18.04+, CentOS 7+)

### **Hardware Recommendations**
- **RAM**: 4GB minimum, 8GB+ recommended for large datasets
- **Storage**: 1GB free space for analysis results and plots
- **Display**: 1920x1080 minimum for optimal GUI experience

---

## üöÄ Quick Start Guide <a id="-quick-start-guide"></a>

### Installation

1. **Download and Install Anaconda/Miniconda**
   ```bash
   # Download from: https://www.anaconda.com/products/distribution#download-section
   ```

2. **Clone the Repository**
   ```bash
   git clone https://github.com/AmanRathoreP/ToxTrac-Data-Analyser
   cd ToxTrac-Data-Analyser
   ```

3. **Set Up Environment**
   ```bash
   conda create --name TDA python=3.13
   conda activate TDA
   pip install -r requirements.txt
   ```

### Basic Usage

**Quick Analysis Example:**
```bash
# Analyze sample data with OFT individual zones
python main.py analyze "samples/Sample-1-Open-Field-side-by-side" --zones oft-individual --inner-ratio 0.55 --plots
```

**Result:** This command generates the `toxtrac_analysis_TIMESTAMP` directory with comprehensive analysis results.

---

## üìä Zone Types & Analysis <a id="-zone-types--analysis"></a>

### **EPM (Elevated Plus Maze)**
```bash
python main.py analyze "samples/EPM Data" --zones epm --plots
```

**Zone Configuration:**
- **Center Zone**: 20% of total maze area (intersection of arms)
- **Open Arms**: East and West arms (anxiety-inducing areas)
- **Closed Arms**: North and South arms (safe areas)

**Key Metrics:**
- Time spent in open vs. closed arms
- Center zone exploration
- Anxiety-related behavioral patterns

### **Open Field Test**
```bash
python main.py analyze "samples/Open Field Data" --zones open-field --plots
```

**Zone Configuration:**
- **Center Zone**: Inner 33% of the field
- **Middle Zone**: 33-66% of the field
- **Peripheral Zone**: Outer edge (thigmotaxis area)

**Key Metrics:**
- Center vs. periphery exploration
- Thigmotactic behavior analysis
- General locomotor activity

### **OFT (Open Field Test) Zones**
```bash
# Unified zones across all sessions
python main.py analyze "samples/OFT Data" --zones oft --inner-ratio 0.6 --plots

# Individual zones for each session
python main.py analyze "samples/Sample-1-Open-Field-side-by-side" --zones oft-individual --inner-ratio 0.55 --plots
```

**Zone Configuration:**
- **Inner Zone**: Configurable ratio of outer zone (default: 60%)
- **Outer Zone**: Encompasses all tracking data with 10% padding

**Key Parameters:**
- `--inner-ratio`: Controls inner zone size (0.0-1.0)

### **Custom Zones**
```bash
# Create custom zones interactively
python main.py create-zones-gui custom_zones.json -t "samples/Sample-1-Open-Field-side-by-side/Tracking_RealSpace_1.txt"

# Use custom zones for analysis
python main.py analyze "samples/Custom Data" --zones custom --custom-zones-file custom_zones.json --plots
```

---

## üíª Command Reference <a id="-command-reference"></a>

### **Main Commands**

#### **`analyze`** - Primary Analysis Command
```bash
python main.py analyze DIRECTORIES [OPTIONS]
```

**Arguments:**
- `DIRECTORIES`: One or more directories containing ToxTrac data

**Key Options:**
- `--zones, -z`: Zone type (epm|open-field|oft|oft-individual|custom)
- `--output, -o`: Output directory (default: ./results)
- `--format, -f`: Output formats (csv|json|console)
- `--plots/--no-plots`: Generate visualization plots
- `--inner-ratio`: Inner zone ratio for OFT (0.0-1.0)
- `--log-level`: Logging verbosity (DEBUG|INFO|WARNING|ERROR)

#### **`create-zones-gui`** - Interactive Zone Creation
```bash
python main.py create-zones-gui zones.json [OPTIONS]
```

**Options:**
- `--tracking-file, -t`: Background tracking data file
- `--background-image, -b`: Background image file for reference (JPG, PNG, etc.)
- `--image-coords`: Image coordinate bounds (required with --background-image)
- `--x-range`: X coordinate range for empty plot
- `--y-range`: Y coordinate range for empty plot

#### **`visualize-zones`** - Zone Visualization
```bash
python main.py visualize-zones zones.json [OPTIONS]
```

**Options:**
- `--tracking-file, -t`: Overlay tracking data
- `--save-image, -s`: Save visualization as image
- `--labels/--no-labels`: Show zone labels
- `--coords/--no-coords`: Show coordinates in labels

#### **`plot-trajectory`** - Trajectory Plotting
```bash
python main.py plot-trajectory tracking_file.txt [OPTIONS]
```

**Options:**
- `--zones-file, -z`: Zone definitions file
- `--color-zones/--no-color-zones`: Color by zones
- `--show-speed/--no-speed`: Color by speed
- `--save-image, -s`: Save plot as image

#### **`list-files`** - File Discovery
```bash
python main.py list-files DIRECTORIES
```

### **Analysis Options**

#### **Movement Statistics**
```bash
# Enable detailed movement analysis
python main.py analyze "samples/Data" --movement

# Disable movement calculations (faster processing)
python main.py analyze "samples/Data" --no-movement
```

#### **Output Customization**
```bash
# Multiple output formats
python main.py analyze "samples/Data" -f csv json console

# Custom output directory
python main.py analyze "samples/Data" -o "results/experiment_1"

# Individual session reports
python main.py analyze "samples/Data" --individual
```

#### **Logging and Debugging**
```bash
# Debug mode with detailed logging
python main.py analyze "samples/Data" --log-level DEBUG --log-file debug.log

# Quiet mode
python main.py analyze "samples/Data" --log-level ERROR
```

### **Output Formats**

#### **CSV Output**
- Structured tabular data
- Compatible with Excel, Python pandas
- Session-wise and summary statistics

#### **JSON Output**
- Machine-readable structured data
- Includes metadata and timestamps
- Nested zone and session information

#### **Console Output**
- Rich formatted terminal display
- Real-time analysis progress
- Summary tables and statistics

---

## üìà Visualization & Plotting <a id="-visualization--plotting"></a>

### **Comprehensive Plot Generation**
```bash
python main.py analyze "samples/Sample-1-Open-Field-side-by-side" --zones oft-individual --inner-ratio 0.55 --plots
```

### **Generated Plot Types**

#### **Per Session (6 plots each):**

1. **Trajectory with Zones** (`*_trajectory_zones.png`)
   - Animal path colored by current zone
   - Zone boundaries overlaid
   - Start/end markers

2. **Speed-Colored Trajectory** (`*_trajectory_speed.png`)
   - Animal path colored by instantaneous speed
   - Speed colorbar for reference
   - Zone boundaries shown

3. **Zone Occupancy** (`*_zone_occupancy.png`)
   - Bar charts of time spent in each zone
   - Entry frequency analysis
   - Percentage and absolute time values

4. **Speed Distribution** (`*_speed_distribution.png`)
   - Histogram of speed values
   - Statistical overlays (mean, median)
   - Distribution analysis

5. **Movement Heatmap** (`*_movement_heatmap.png`)
   - Density map of animal positions
   - Hot spots identification
   - Zone boundary overlays

6. **Time Series Analysis** (`*_timeseries.png`)
   - Speed over time with moving averages
   - Distance from center over time
   - Zone occupancy time series

#### **Summary Plots (2 plots total):**

1. **Session Comparison** (`session_comparison.png`)
   - Zone occupancy comparison across sessions
   - Total distance comparison
   - Side-by-side statistical analysis

2. **Zone Usage Summary** (`zone_usage_summary.png`)
   - Average time spent per zone (with error bars)
   - Entry frequency across sessions
   - Statistical significance indicators

### **Plot Specifications**
- **Resolution**: 300 DPI (publication quality)
- **Format**: PNG (with optional PDF/SVG support)
- **Size**: Optimized for papers and presentations
- **Colors**: Colorblind-friendly palettes

---

## üìÅ Input/Output Structure <a id="-inputoutput-structure"></a>

### **Input Data Structure**
```
samples/
‚îú‚îÄ‚îÄ Sample-1-Open-Field-side-by-side/
‚îÇ   ‚îú‚îÄ‚îÄ Tracking_RealSpace_1.txt    # Primary tracking data
‚îÇ   ‚îú‚îÄ‚îÄ Tracking_RealSpace_2.txt    # Additional session data
‚îÇ   ‚îú‚îÄ‚îÄ Stats_1.txt                 # ToxTrac statistics (optional)
‚îÇ   ‚îú‚îÄ‚îÄ Distribution_Speed_1.txt    # Speed distributions (optional)
‚îÇ   ‚îî‚îÄ‚îÄ ...                         # Other ToxTrac outputs
‚îî‚îÄ‚îÄ Other Experiments/
    ‚îî‚îÄ‚îÄ ...
```

### **Output Structure**
```
results/
‚îî‚îÄ‚îÄ toxtrac_analysis_20250715_100805/    # Timestamped directory
    ‚îú‚îÄ‚îÄ analysis_results.csv              # Main results table
    ‚îú‚îÄ‚îÄ analysis_results.json             # Structured data
    ‚îî‚îÄ‚îÄ plots/                            # Visualization directory
        ‚îú‚îÄ‚îÄ Tracking_RealSpace_1/         # Session-specific plots
        ‚îÇ   ‚îú‚îÄ‚îÄ Tracking_RealSpace_1_trajectory_zones.png
        ‚îÇ   ‚îú‚îÄ‚îÄ Tracking_RealSpace_1_trajectory_speed.png
        ‚îÇ   ‚îú‚îÄ‚îÄ Tracking_RealSpace_1_zone_occupancy.png
        ‚îÇ   ‚îú‚îÄ‚îÄ Tracking_RealSpace_1_speed_distribution.png
        ‚îÇ   ‚îú‚îÄ‚îÄ Tracking_RealSpace_1_movement_heatmap.png
        ‚îÇ   ‚îî‚îÄ‚îÄ Tracking_RealSpace_1_timeseries.png
        ‚îú‚îÄ‚îÄ Tracking_RealSpace_2/         # Second session plots
        ‚îÇ   ‚îî‚îÄ‚îÄ ...
        ‚îî‚îÄ‚îÄ summary/                      # Cross-session analysis
            ‚îú‚îÄ‚îÄ session_comparison.png
            ‚îî‚îÄ‚îÄ zone_usage_summary.png
```

### **Expected Input File Format**
ToxTrac `Tracking_RealSpace.txt` files with columns:
```
time(s)  arena  track  x-pos(mm)  y-pos(mm)  label  video_seq
0.0333   1      1      45.2       67.8       1      0
0.0667   1      1      45.8       68.1       1      0
...
```

---

## üî¨ Analysis Results <a id="-analysis-results"></a>

### **Zone Analysis Metrics**

Each zone analysis includes:

#### **Time Statistics**
- **Total Time Inside**: Absolute time spent in zone (seconds)
- **Total Time Outside**: Time spent outside the zone
- **Percentage Inside**: Proportion of session time in zone (0-100%)

#### **Visit Patterns**
- **Entry Count**: Number of times animal entered the zone
- **Exit Count**: Number of times animal left the zone
- **Mean Visit Duration**: Average time per visit
- **Longest Visit**: Maximum continuous time in zone
- **Shortest Visit**: Minimum visit duration

#### **Movement Analysis**
- **Distance Inside**: Total distance traveled while in zone (mm)
- **Distance Outside**: Distance traveled outside the zone
- **Mean Speed Inside**: Average speed while in zone (mm/s)
- **Mean Speed Outside**: Average speed while outside zone

### **Session-Level Statistics**
- **Total Duration**: Complete session length
- **Total Distance**: Overall distance traveled
- **Mean Speed**: Session average speed
- **Sampling Rate**: Data acquisition frequency

### **Gap Detection & Handling**
- **Missing Frame Detection**: Identifies periods of no animal detection
- **Gap Statistics**: Count and duration of missing data periods
- **Linear Interpolation**: Smart interpolation for missing coordinates
- **Warning System**: Alerts for extensive missing data (>10 consecutive points)

---

## üõ†Ô∏è Advanced Usage <a id="-advanced-usage"></a>

### **Batch Processing Multiple Experiments**
```bash
# Process multiple experiment directories
python main.py analyze "samples/Experiment_1" "samples/Experiment_2" "samples/Experiment_3" --zones oft-individual --plots -o "results/batch_analysis"
```

### **Custom Zone Creation Workflow**
```bash
# Step 1: Create zones interactively with tracking data
python main.py create-zones-gui experiment_zones.json -t "samples/Sample-1-Open-Field-side-by-side/Tracking_RealSpace_1.txt"

# OR: Create zones with background image reference
python main.py create-zones-gui experiment_zones.json -b arena_photo.jpg --image-coords="-150,-100,150,100"

# Step 2: Visualize created zones
python main.py visualize-zones experiment_zones.json -t "samples/Sample-1-Open-Field-side-by-side/Tracking_RealSpace_1.txt" --save-image zone_preview.png

# Step 3: Apply zones to analysis
python main.py analyze "samples/Sample-1-Open-Field-side-by-side" --zones custom --custom-zones-file experiment_zones.json --plots
```

### **High-Performance Analysis**
```bash
# Disable plots for faster processing
python main.py analyze "samples/Large_Dataset" --zones oft --no-plots --format json

# Memory-efficient processing with logging
python main.py analyze "samples/Large_Dataset" --zones oft --log-level WARNING --no-movement
```

### **Research Publication Workflow**
```bash
# Generate publication-ready outputs
python main.py analyze "samples/Paper_Data" --zones epm --plots --format csv json --individual --log-level INFO --log-file analysis.log
```

---

## üìö Examples <a id="-examples"></a>

### **Example 1: Basic EPM Analysis**
```bash
# Analyze EPM data with standard zones
python main.py analyze "samples/EPM_Experiment" --zones epm --plots --format csv console
```

**Output:** Time spent in open vs. closed arms, center exploration, anxiety indices

### **Example 2: Open Field with Custom Parameters**
```bash
# Open field analysis with detailed logging
python main.py analyze "samples/Open_Field_Study" --zones open-field --plots --individual --log-level DEBUG --log-file openfield.log
```

**Output:** Center vs. periphery analysis, thigmotactic behavior, locomotor activity

### **Example 3: Multi-Session OFT Analysis**
```bash
# Individual OFT zones for each session
python main.py analyze "samples/Sample-1-Open-Field-side-by-side" --zones oft-individual --inner-ratio 0.55 --plots --format json csv
```

**Output:** Session-specific zone analysis with 0.55 inner zone ratio (generates the example `toxtrac_analysis_20250715_100805` directory)

### **Example 4: Custom Zone Research with Background Image**
```bash
# Create custom zones using arena photo as reference
python main.py create-zones-gui novel_apparatus.json -b arena_setup.jpg --image-coords="-150,-100,150,100"

# Alternative: Create with tracking data background
python main.py create-zones-gui novel_apparatus.json -t "samples/tracking_data.txt"

# Apply to experimental data
python main.py analyze "samples/Novel_Apparatus" --zones custom --custom-zones-file novel_apparatus.json --plots --individual
```

### **Example 5: Batch Processing with Quality Control**
```bash
# Process multiple sessions with comprehensive output
python main.py analyze "samples/Batch_1" "samples/Batch_2" --zones oft --inner-ratio 0.6 --plots --format csv json console --individual --log-level INFO --log-file batch_analysis.log
```

### **Example 6: File Discovery and Visualization**
```bash
# Discover all tracking files
python main.py list-files "samples/"

# Create trajectory plot
python main.py plot-trajectory "samples/Sample-1-Open-Field-side-by-side/Tracking_RealSpace_1.txt" --color-zones --save-image trajectory.png
```

### **Example 7: Zone Validation Workflow**
```bash
# Create zones
python main.py create-zones-gui test_zones.json -t "samples/Sample-1-Open-Field-side-by-side/Tracking_RealSpace_1.txt"

# Validate zones visually
python main.py visualize-zones test_zones.json -t "samples/Sample-1-Open-Field-side-by-side/Tracking_RealSpace_1.txt" --coords --save-image validation.png

# Apply and analyze
python main.py analyze "samples/Sample-1-Open-Field-side-by-side" --zones custom --custom-zones-file test_zones.json --plots
```

---

## ü§ù Contributing <a id="-contributing"></a>

We welcome contributions to the ToxTrac Data Analyzer! Here's how you can help:

### **Ways to Contribute**
- üêõ **Bug Reports**: Report issues with detailed reproduction steps
- üí° **Feature Requests**: Suggest new analysis methods or visualizations
- üìù **Documentation**: Improve documentation and examples
- üî¨ **Code Contributions**: Implement new features or fix bugs
- üß™ **Testing**: Help test the software with different data types

### **Contribution Guidelines**
1. **Fork the repository** and create a feature branch
2. **Follow code standards** and include comprehensive tests
3. **Update documentation** for any new features
4. **Submit a pull request** with detailed description

### **Development Setup**
Same as [Installation](#installation).

### **Code of Conduct**
Please read and follow our [Code of Conduct](issues.md) for all interactions.

---

## üë®‚Äçüíª About Author <a id="-about-author"></a>

**Aman Rathore** - Lead Developer & Researcher

- üåê **Website**: [amanr.me](https://amanr.me/)
- üìß **Email**: [aman.proj.rel@gmail.com](mailto:aman.proj.rel@gmail.com)
- üíº **LinkedIn**: [@amanrathorep](https://www.linkedin.com/in/amanrathorep/)
- üê± **GitHub**: [@AmanRathoreP](https://github.com/AmanRathoreP) | [@AmanRathoreM](https://github.com/AmanRathoreM)
- üì± **Telegram**: [@aman0864](https://t.me/aman0864)
- üì∏ **Instagram**: [@aman__0864](https://www.instagram.com/aman__0864/)

**Background**: Computational neuroscience researcher specializing in behavioral analysis tools and animal tracking systems. Passionate about creating open-source software for the scientific community.

---

## üìú License <a id="-license"></a>

[Code Credit License v1.1.0](https://codecreditlicense.com/license/1.1.0) | [LICENSE](LICENSE.md/)

Copyright (c) 2025, [Aman Rathore](https://amanr.me)

---

<div align="center">
  <p><strong>üê≠ ToxTrac Data Analyzer - Empowering Behavioral Research Through Advanced Analytics</strong></p>
  <p>Made with ‚ù§Ô∏è for the neuroscience research community</p>
</div>
